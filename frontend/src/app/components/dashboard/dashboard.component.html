
<!-- Welcome Section -->
<div class="mb-8">
  <h1 class="font-montserrat font-bold text-3xl text-gray-900 mb-2">
    Hola {{ userName }}!
  </h1>
  <p class="font-noto-sans text-lg text-gray-600">
    Bienvenido al Panel de control. Aquí puedes consultar estadísticas y actividad relevante.
  </p>
</div>

<!-- ADMIN DASHBOARD -->
<ng-container *ngIf="userRole === 'admin'; else vendedorDashboard">

  <!-- Selector de periodo -->
  <div class="flex justify-end mb-4">
    <select [(ngModel)]="selectedPeriod" (change)="onPeriodChange()" class="select select-bordered w-full max-w-xs">
      <option value="week">Última Semana</option>
      <option value="month">Último Mes</option>
      <option value="year">Último Año</option>
    </select>
  </div>

  <!-- KPI Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <p class="font-noto-sans text-sm text-gray-600">Total Clientes Potenciales</p>
        <p class="font-montserrat font-bold text-2xl text-gray-900">{{ stats.totalLeads }}</p>
      </div>
    </div>
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <p class="font-noto-sans text-sm text-gray-600">Cotizaciones</p>
        <p class="font-montserrat font-bold text-2xl text-gray-900">{{ stats.totalQuotes }}</p>
      </div>
    </div>
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <p class="font-noto-sans text-sm text-gray-600">Producto más cotizado</p>
        <p class="font-montserrat font-bold text-sm text-gray-900">{{ stats.most_quoted_product }}</p>
      </div>
    </div>
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <p class="font-noto-sans text-sm text-gray-600">Vendedor más activo</p>
        <p class="font-montserrat font-bold text-lg text-gray-900">{{ stats.most_active_seller }}</p>
      </div>
    </div>
  </div>

  <!-- Gráficos Admin -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title font-montserrat text-lg text-gray-900">Cotizaciones por Vendedor</h2>
        <canvas id="quotesBySellerChart"></canvas>
      </div>
    </div>
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title font-montserrat text-lg text-gray-900">Top Productos Cotizados</h2>
        <canvas id="topProductsChart"></canvas>
      </div>
    </div>
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title font-montserrat text-lg text-gray-900">Evolución de Cotizaciones</h2>
        <canvas id="quotesOverTimeChart"></canvas>
      </div>
    </div>
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title font-montserrat text-lg text-gray-900">Chatbot vs Vendedores</h2>
        <canvas id="channelComparisonChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Tabla de leads globales -->
  <div class="card bg-base-100 shadow-xl text-gray-600">
    <div class="card-body">
      <h2 class="card-title font-montserrat text-xl text-gray-900">Clientes Potenciales Recientes</h2>
      <div class="overflow-x-auto">
        <table class="table table-zebra w-full">
          <thead>
            <tr class="text-gray-700 font-montserrat">
              <th>Nombre</th>
              <th>Email</th>
              <th>Teléfono</th>
              <th>Fecha</th>
            </tr>
          </thead>
          <tbody class="font-noto-sans">
            <tr *ngFor="let lead of leads">
              <td class="font-medium">{{ lead.name | titlecase }}</td>
              <td>{{ lead.email }}</td>
              <td>{{ lead.phone }}</td>
              <td>{{ lead.date | date:'short' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</ng-container>

<!-- VENDEDOR DASHBOARD -->
<ng-template #vendedorDashboard>
  <!-- KPI Cards mensuales -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <p class="font-noto-sans text-sm text-gray-600">Tus Cotizaciones (Mes)</p>
        <p class="font-montserrat font-bold text-2xl text-gray-900">{{ stats.totalQuotes }}</p>
      </div>
    </div>
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <p class="font-noto-sans text-sm text-gray-600">Tus Clientes Potenciales (Mes)</p>
        <p class="font-montserrat font-bold text-2xl text-gray-900">{{ stats.totalLeads }}</p>
      </div>
    </div>
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <p class="font-noto-sans text-sm text-gray-600">Ticket Promedio</p>
        <p class="font-montserrat font-bold text-2xl text-gray-900">{{ stats.avgTicket }}$</p>
      </div>
    </div>
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <p class="font-noto-sans text-sm text-gray-600">Clientes Atendidos</p>
        <p class="font-montserrat font-bold text-2xl text-gray-900">{{ stats.totalClients }}</p>
      </div>
    </div>
  </div>

  <!-- Gráficos Vendedor -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title font-montserrat text-lg text-gray-900">Tus Cotizaciones en el Tiempo</h2>
        <canvas id="sellerQuotesOverTimeChart"></canvas>
      </div>
    </div>
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title font-montserrat text-lg text-gray-900">Tus Productos más Cotizados</h2>
        <canvas id="sellerTopProductsChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Tabla de leads personales -->
  <div class="card bg-base-100 shadow-xl text-gray-600">
    <div class="card-body">
      <h2 class="card-title font-montserrat text-xl text-gray-900">Tus clientes potenciales recientes</h2>
      <div class="overflow-x-auto">
        <table class="table table-zebra w-full">
          <thead>
            <tr class="text-gray-700 font-montserrat">
              <th>Nombre</th>
              <th>Email</th>
              <th>Teléfono</th>
              <th>Fecha</th>
            </tr>
          </thead>
          <tbody class="font-noto-sans">
            <tr *ngFor="let lead of leads">
              <td class="font-medium">{{ lead.name }}</td>
              <td>{{ lead.email }}</td>
              <td>{{ lead.phone }}</td>
              <td>{{ lead.date | date:'short' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</ng-template>
